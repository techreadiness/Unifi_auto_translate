name: Translate Documentation

on:
  push:
    branches:
      - main
  workflow_dispatch:

jobs:
  translate:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Translate Markdown Files
        env:
          DEEPL_AUTH_KEY: ${{ secrets.DEEPL_API_KEY }}
        run: |
          mkdir -p ko
          for file in *.md; do
            if [ -f "$file" ]; then
              echo "Translating $file..."
              RESPONSE=$(curl -s -X POST 'https://api-free.deepl.com/v2/translate' \
                -H "Authorization: DeepL-Auth-Key $DEEPL_AUTH_KEY" \
                -d "target_lang=KO" \
                -d "text=$(cat "$file")")
              
              TRANSLATED_TEXT=$(echo $RESPONSE | jq -r '.translations[0].text')
              
              if [ "$TRANSLATED_TEXT" != "null" ]; then
                echo "$TRANSLATED_TEXT" > "ko/$file"
              else
                echo "Failed to translate $file"
              fi
            fi
          done

      - name: Commit and Push Changes
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          git add ko/
          git commit -m "Translated documentation to Korean"
          git push
